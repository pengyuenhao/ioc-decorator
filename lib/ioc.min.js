!function(t){var e=function(){function t(t,n){void 0===n&&(n=null),this._value=t,this._next=n}return Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"next",{get:function(){return this._next},set:function(t){this._next=t},enumerable:!0,configurable:!0}),t}();t.Item=e;var n=function(){function t(){this._size=0,this._header=new e(null)}return t.prototype.top=function(){return 0===this._size?null:this._header.next.value},t.prototype.push=function(t){var n=new e(t);n.next=this._header.next,this._header.next=n,this._size++},t.prototype.pop=function(){if(0===this._size)return null;var t=this._header.next;return this._header.next=t.next,this._size--,t.next=null,t.value},t.prototype.clear=function(){for(var t=this._header;0!==this._size;)(t=t.next).next=null,this._size--;this._header=null},Object.defineProperty(t.prototype,"isEmpty",{get:function(){return 0===this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),t}();t.Stack=n}(ioc||(ioc={})),function(t){var n;(n=t.CommonEnum||(t.CommonEnum={})).Context="Context",n.Root="Root",(t.IocError||(t.IocError={})).IC_ERROR="can't implement class that is only as interface";var e=function(){};t.IConstructorName=e}(ioc||(ioc={})),function(t){var n=function(){function t(){}return t.isProtetype=function(t,n){return t instanceof n},t.getPrototypeList=function(t){var n=this;if(!this.hasPrototypeList(t)){var e=void 0;e=[];for(var o,i=[],r=t.__proto__;r&&(o=r.constructor)!==Object;)o.name.startsWith("N")||(e.push(o),i.push(o),i.forEach(function(t){n.AddPrototype(t,o)})),r=r.__proto__}var s=this.prototypeMap.get(t.constructor);return Array.from(s)},t.AddPrototype=function(t,n){var e;this.prototypeMap.has(t)?e=this.prototypeMap.get(t):(e=new Set,this.prototypeMap.set(t,e)),e.add(n)},t.hasPrototypeList=function(t){return!!this.prototypeMap.has(t.constructor)},t.prototypeMap=new Map,t}();t.Prototype=n}(ioc||(ioc={})),function(t){var n=function(){function t(){}return Object.defineProperty(t.prototype,"constructorName",{get:function(){return"IBinding"},enumerable:!0,configurable:!0}),t}();t.NBinding=n;var e=function(){function n(t){this._resolver=t,this._key=null,this._value=null,this._name=null}return Object.defineProperty(n.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),n.prototype.bind=function(t){return this._key=n.checkAbstract(t),this},n.prototype.to=function(t){return this._value=t,null!=this._resolver&&this._resolver(this),this},n.prototype.toName=function(t){return this._name=t,null!=this._resolver&&this._resolver(this),this},Object.defineProperty(n.prototype,"isKeyConstructor",{get:function(){return n.isConstructor(this._key)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isValueConstructor",{get:function(){return n.isConstructor(this._value)},enumerable:!0,configurable:!0}),n.isConstructor=function(t){return"function"==typeof t&&!!t.prototype},n.checkAbstract=function(t){return null!==t.constructorName&&void 0!==t.constructorName?t.constructorName:t},n}();t.Binding=e}(ioc||(ioc={})),function(r){var t=function(){function t(){}return Object.defineProperty(t.prototype,"constructorName",{get:function(){return"IBinder"},enumerable:!0,configurable:!0}),t}();r.NBinder=t;var n=function(){function t(){this.init()}return t.prototype.init=function(){this._bindings=new Map},t.prototype.resolver=function(t){var n=t.key;this.resolveBinding(t,n)},t.prototype.resolveBinding=function(t,n){var e,o=null==t.name?r.BindingConst.NULL:t.name;if(this._bindings.has(n)){if((e=this._bindings.get(n)).has(o)){var i=e.get(o);i!=t&&(i.value||e.delete(o))}}else e=new Map,this._bindings.set(n,e);e.has(r.BindingConst.NULL)&&e.get(r.BindingConst.NULL)===t&&e.delete(r.BindingConst.NULL),e.has(o)||e.set(o,t)},t.prototype.bind=function(t){var n=this.getRawBinding();return n.bind(t),n},t.prototype.unbind=function(t,n){var e=r.Binding.checkAbstract(t);if(this._bindings.has(e)){var o=this._bindings.get(e),i=void 0;i=n||r.BindingConst.NULL,o.has(i)&&o.delete(i)}},t.prototype.getRawBinding=function(){return new r.Binding(this.resolver.bind(this))},t.prototype.getBinding=function(t,n){if(this._bindings.has(t)){var e=this._bindings.get(t);return n||(n=r.BindingConst.NULL),e.has(n)?e.get(n):null}},t.prototype.getBindingMap=function(t){if(this._bindings.has(t))return this._bindings.get(t)},t}();r.Binder=n}(ioc||(ioc={})),function(t){(t.BindingConst||(t.BindingConst={})).NULL=Symbol("NULL")}(ioc||(ioc={}));var __extends=this&&this.__extends||function(){var o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)};return function(t,n){function e(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}();!function(t){var n=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"property",{get:function(){return this._property},enumerable:!0,configurable:!0}),t.prototype.toProperty=function(t){return this._property=t,null!=this._resolver&&this._resolver(this),this},t.prototype.to=function(t){return n.prototype.to.call(this,t)},t.prototype.toName=function(t){return n.prototype.toName.call(this,t)},t}(t.Binding);t.DecoratorClassBinding=n}(ioc||(ioc={}));__extends=this&&this.__extends||function(){var o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)};return function(t,n){function e(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}();!function(l){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.init=function(){this._bindings=new Map,this._decoratorClassBufferMap=new Map},t.prototype.has=function(t){return this._bindings.has(t)},t.prototype.get=function(t){if(!(t instanceof Object))throw new Error("proto must is a object but"+t+"is not");if(!this._decoratorClassBufferMap.has(t)){var n=l.Prototype.getPrototypeList(t),e=new l.DecoratorClass,o=[],i=void 0,r=[];if(n&&0<n.length)for(var s=0;s<n.length;s++)(i=this.getBindingMap(n[s]))&&0<i.size&&i.forEach(function(t){r.push(t)});var c=void 0;if(r&&0<r.length)for(s=0;s<r.length;s++)if((c=r[s])&&0<c.size)for(var a=c.values(),u=0;u<c.size;u++){var p=a.next();o.push(p.value)}e.list=o,this._decoratorClassBufferMap.set(t,e)}return this._decoratorClassBufferMap.get(t)},t.prototype.bind=function(t){return e.prototype.bind.call(this,t)},t.prototype.getBinding=function(t,n){return e.prototype.getBinding.call(this,t,n)},t.prototype.getRawBinding=function(){return new l.DecoratorClassBinding(this.resolver.bind(this))},t.prototype.resolver=function(t){e.prototype.resolver.call(this,t)},t.prototype.resolveBinding=function(t,n){if(t.property){var e,o,i=null==t.name?l.BindingConst.NULL:t.name;if(this._bindings.has(n)){if((e=this._bindings.get(n)).has(i)){var r=e.get(i);if(r.has(t.property))(c=r.get(t.property))&&c!=t&&(c.value||e.delete(i))}}else e=new Map,this._bindings.set(n,e);if(e.has(l.BindingConst.NULL)){var s=e.get(l.BindingConst.NULL);if(s.has(t.property)){var c=s.get(t.property);t.property===t&&s.delete(l.BindingConst.NULL)}}e.has(i)?(o=e.get(i)).has(t.property)||o.set(t.property,t):((o=new Map).set(t.property,t),e.set(i,o))}},t.prototype.getBindingMap=function(t){if(this._bindings.has(t))return this._bindings.get(t)},t}(l.Binder);l.DecoratorClassBinder=t}(ioc||(ioc={})),function(t){(t.DecoratorConst||(t.DecoratorConst={})).DECORATOR_CLASS_BINDER=new t.DecoratorClassBinder}(ioc||(ioc={})),function(e){var t=function(){function t(){}return t.prototype.get=function(t,n){if(null==t)throw new Error("InjectorFactory cannot act on null binding");switch(t.getBindingType()){case"Singleton":return this.singletonOf(t,n);case"Value":return this.getValueOf(t)}return this.instanceOf(t,n)},t.prototype.instanceOf=function(t,n){if(null!=t.value)return this.createFromValue(t.value,n);var e=this.generateImplicit(t.key,n);return this.createFromValue(e,n)},t.prototype.createFromValue=function(t,n){var e=null;try{e=null==n||0==n.length?new t:new t(n)}catch(t){}return e},t.prototype.generateImplicit=function(t,n){if(!t)return null;if(e.Binding.isConstructor(t))return this.createFromValue(t,n);throw new Error("InjectorFactory can't instantiate an Interface or Abstract Class. Class: "+t.ToString())},t.prototype.singletonOf=function(t,n){if(null!=t.value){var e=this.createFromValue(t.value,n);if(null==e)return null;t.setValue(e)}else t.setValue(this.generateImplicit(t.key,n));return t.value},t.prototype.getValueOf=function(t){return t.value},t}();e.InjectFactory=t}(ioc||(ioc={})),function(n){var t=function(){function t(){this.factory=null,this.binder=null,this.injectClassBinder=null,this.factory=new n.InjectFactory}return t.prototype.uninject=function(t){if(!this.binder||!t)throw new Error("Attempt to inject into Injector without a Binder or null instance");var n=typeof t;if("string"===n||"boolean"===n||"number"===n||"symbol"===n||"undefined"===n||"function"===n)return t;var e=this.injectClassBinder.get(t);this.decoratorUnInject(t,e)},t.prototype.decoratorUnInject=function(n,t){var e=this;t.list.forEach(function(t){e.binder.getBinding(t.value,t.name)&&(n[t.property]=null)})},t.prototype.instantiate=function(t,n){if(!this.binder||!this.factory)throw new Error("Attempt to instantiate from Injector without a Binder or inject into Injector without a Factory");var e=null,o=null;if(t.isValueConstructor?e=t.value:o=t.value,!e&&t.isKeyConstructor&&(e=t.key),!o&&e){var i=t.getArgs();o=this.factory.get(t,i),n&&this.tryInject(t,o)}return o},t.prototype.tryInject=function(t,n){return null!=n&&(t.isInject()&&(n=this.inject(n,!1)),"Singleton"!=t.getBindingType()&&"Value"!=t.getBindingType()||t.toInject(!1)),n},t.prototype.inject=function(t,n){if(!this.binder||!t)throw new Error("Attempt to inject into Injector without a Binder or null instance");var e=typeof t;if("string"===e||"boolean"===e||"number"===e||"symbol"===e||"undefined"===e||"function"===e)return t;var o=this.injectClassBinder.get(t);return this.decoratorInject(t,o),t},t.prototype.decoratorInject=function(o,t){var i=this;t.list.forEach(function(t){var n=i.binder.getBinding(t.value,t.name);if(n){var e=i.getInjectValue(n.key,n.name);o[t.property]=e}})},t.prototype.getInjectValue=function(t,n){var e=this.binder.getBinding(t,n);if(!e)return null;if("Value"!==e.getBindingType())return"Singleton"==e.getBindingType()?((e.isValueConstructor||null==e.value)&&this.instantiate(e,!0),e.value):this.instantiate(e,!0);if(e.isInject()){var o=this.inject(e.value,!1);return e.toInject(!1),o}return e.value},t}();n.Injector=t}(ioc||(ioc={}));__extends=this&&this.__extends||function(){var o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)};return function(t,n){function e(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}();!function(t){var n=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t._isUnbind=!1,t._bindingType="Default",t._isInject=!0,t}return __extends(t,n),t.prototype.isInject=function(){return this._isInject},t.prototype.getArgs=function(){return this._args},t.prototype.getBindingType=function(){return this._bindingType},t.prototype.isUnbind=function(){return this._isUnbind},t.prototype.toArgs=function(){return this._args=arguments,null!=this._resolver&&this._resolver(this),this},t.prototype.toSingleton=function(){return"Value"===this._bindingType||(this._bindingType="Singleton",null!=this._resolver&&this._resolver(this)),this},t.prototype.unBind=function(){return this._isUnbind=!0,this},t.prototype.toValue=function(t){return this._bindingType="Value",this.setValue(t),this},t.prototype.setValue=function(t){return this.to(t),this},t.prototype.toInject=function(t){return this._isInject=t,this},t.prototype.to=function(t){return n.prototype.to.call(this,t)},t.prototype.toName=function(t){return n.prototype.toName.call(this,t)},t}(t.Binding);t.InjectBinding=n}(ioc||(ioc={}));__extends=this&&this.__extends||function(){var o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)};return function(t,n){function e(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}();!function(i){var n=i.DecoratorConst.DECORATOR_CLASS_BINDER,t=function(){function t(){}return Object.defineProperty(t.prototype,"constructorName",{get:function(){return"IInjectBinder"},enumerable:!0,configurable:!0}),t}();i.NInjectBinder=t;var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.init=function(){e.prototype.init.call(this),this._injector=new i.Injector,(this._injector.binder=this)._injector.injectClassBinder=n},t.prototype.getInjector=function(){return this._injector},t.prototype.getInstance=function(t,n){n||(n=i.BindingConst.NULL);var e=this.getBinding(i.Binding.checkAbstract(t),n);if(null==e)throw new Error("InjectionBinder has no binding for:\n\tkey: "+t+"\nname: "+n);var o=this._injector.instantiate(e,!1);return this._injector.tryInject(e,o),o},t.prototype.inject=function(t,n){this.getInjector().inject(t)},t.prototype.getBinding=function(t,n){return e.prototype.getBinding.call(this,t,n)},t.prototype.bind=function(t){return e.prototype.bind.call(this,t)},t.prototype.getRawBinding=function(){return new i.InjectBinding(this.resolver.bind(this))},t.prototype.unbindAllMark=function(){var n=this,e=[];this._bindings.forEach(function(t){t.forEach(function(t){t.isUnbind()&&e.push(t)})}),e.forEach(function(t){n.unbind(t.key,t.name)})},t}(i.Binder);i.InjectBinder=e}(ioc||(ioc={})),function(i){var r=i.DecoratorConst.DECORATOR_CLASS_BINDER;i.inject=function(){switch(arguments.length){case 0:break;case 1:return t(arguments[0]);case 2:return n(arguments[0],arguments[1])}};var t=function(e){return function(t,n){s(t,e,n)}},n=function(e,o){return function(t,n){s(t,e,n,o)}};function s(t,n,e,o){r.bind(t.constructor).to(i.Binding.checkAbstract(n)).toProperty(e).toName(o)}}(ioc||(ioc={}));var __decorate=this&&this.__decorate||function(t,n,e,o){var i,r=arguments.length,s=r<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;0<=c;c--)(i=t[c])&&(s=(r<3?i(s):3<r?i(n,e,s):i(n,e))||s);return 3<r&&s&&Object.defineProperty(n,e,s),s};!function(n){var i,t,e,o,r,s;(t=i=n.PoolOverflowBehavior||(n.PoolOverflowBehavior={}))[t.EXCEPTION=0]="EXCEPTION",t[t.WARNING=1]="WARNING",t[t.IGNORE=2]="IGNORE",(o=e=n.BindingConstraintType||(n.BindingConstraintType={}))[o.ONE=0]="ONE",o[o.MANY=1]="MANY",o[o.POOL=2]="POOL",(s=r=n.PoolInflationType||(n.PoolInflationType={}))[s.INCREMENT=0]="INCREMENT",s[s.DOUBLE=1]="DOUBLE";var c=function(){function t(){}return Object.defineProperty(t.prototype,"constructorName",{get:function(){return"IInstanceProvider"},enumerable:!0,configurable:!0}),t}();n.NInstanceProvider=c;var a=function(){function t(){this.instancesAvailable=new n.Stack,this.instancesInUse=new Set}return t.prototype.Pool=function(){this.size=0,this.constraint=e.POOL,this.uniqueValues=!0,this.overflowBehavior=i.EXCEPTION,this.inflationType=r.DOUBLE},t.prototype.bind=function(t){this.poolType=t},t.prototype.add=function(t){return this.failIf(!n.Prototype.isProtetype(t,this.poolType)," Pool Type mismatch. Pools must consist of a common concrete type.\n\t\tPool type: "+this.poolType+"\n\t\tMismatch type: "+t),this._instanceCount++,this.instancesAvailable.push(t),this},t.prototype.addList=function(t){var n=this;return t&&0<t.length&&t.forEach(function(t){n.add(t)}),this},t.prototype.remove=function(t){return this._instanceCount--,this.removeInstance(t),this},t.prototype.removeList=function(t){var n=this;return t&&0<t.length&&t.forEach(function(t){n.remove(t)}),this},Object.defineProperty(t.prototype,"value",{get:function(){return this.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"instanceCount",{get:function(){return this._instanceCount},enumerable:!0,configurable:!0}),t.prototype.getInstance=function(){if(0<this.instancesAvailable.size){var t=this.instancesAvailable.pop();return this.instancesInUse.add(t),t}var n=0;if(0<this.size){if(0!=this.instanceCount)return this.failIf(this.overflowBehavior==i.EXCEPTION,"A pool has overflowed its limit.\n\t\tPool type: "+this.poolType),this.overflowBehavior,i.WARNING,null;n=this.size}else n=0==this.instanceCount||this.inflationType==r.INCREMENT?1:this.instanceCount;if(0<n){this.failIf(null==this.instanceProvider,"A Pool of type: "+this.poolType+" has no instance provider.");for(var e=0;e<n;e++){var o=this.instanceProvider.getInstance(this.poolType);this.add(o)}return this.getInstance()}return null},t.prototype.returnInstance=function(t){this.instancesInUse.has(t)&&(t.restore(),this.instancesInUse.delete(t),this.instancesAvailable.push(t))},t.prototype.clean=function(){this.instancesAvailable.clear(),this.instancesInUse=new Set,this._instanceCount=0},Object.defineProperty(t.prototype,"available",{get:function(){return this.instancesAvailable.size},enumerable:!0,configurable:!0}),t.prototype.restore=function(){this.clean(),this.size=0},t.prototype.retain=function(){this.isRetain=!0},t.prototype.release=function(){this.isRetain=!1},t.prototype.removeInstance=function(t){this.failIf(t!=this.poolType,"Attempt to remove a instance from a pool that is of the wrong Type:\n\t\tPool type: "+this.poolType.toString()+"\n\t\tInstance type: "+t.toString()),this.instancesInUse.has(t)?this.instancesInUse.delete(t):this.instancesAvailable.pop()},t.prototype.failIf=function(t,n){if(t)throw new Error(n)},__decorate([n.inject(c)],t.prototype,"instanceProvider",void 0),t}();n.Pool=a}(ioc||(ioc={})),function(t){var n=function(){function t(){}return Object.defineProperty(t.prototype,"constructorName",{get:function(){return"ICommandBinder"},enumerable:!0,configurable:!0}),t}();t.NCommandBinder=n}(ioc||(ioc={})),function(t){(t.CommandConst||(t.CommandConst={})).COMMAND_POOL="COMMAND_POOL"}(ioc||(ioc={}));__extends=this&&this.__extends||function(){var o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)};return function(t,n){function e(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}();!function(t){var n=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return __extends(t,n),Object.defineProperty(t.prototype,"isSequence",{get:function(){return this._isSequence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOnce",{get:function(){return this._isOnce},enumerable:!0,configurable:!0}),t.prototype.to=function(t){return n.prototype.to.call(this,t)},t.prototype.toName=function(t){return n.prototype.toName.call(this,t)},t.prototype.Pooled=function(){return this.isPooled=!0,this._resolver(this),this},t}(t.Binding);t.CommandBinding=n}(ioc||(ioc={}));__extends=this&&this.__extends||function(){var o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)};return function(t,n){function e(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),__decorate=this&&this.__decorate||function(t,n,e,o){var i,r=arguments.length,s=r<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;0<=c;c--)(i=t[c])&&(s=(r<3?i(s):3<r?i(n,e,s):i(n,e))||s);return 3<r&&s&&Object.defineProperty(n,e,s),s};!function(r){var t=function(i){function t(){var t=null!==i&&i.apply(this,arguments)||this;return t.pools=new Map,t.activeCommands=new Set,t.activeSequences=new Map,t.usePooling=!1,t}return __extends(t,i),t.prototype.getPool=function(t){return this.pools.has(t)?this.pools.get(t):null},t.prototype.resolver=function(t){var e=this;if(i.prototype.resolver.call(this,t),this.usePooling&&t.isPooled&&null!=t.value){var o=this,n=t.value;0===n.length&&(n=[]).push(t.value),n&&0<n.length&&n.forEach(function(t){if(0==o.pools.has(t)){var n=e.makePoolFromType(t);o.pools.set(t,n)}})}},t.prototype.makePoolFromType=function(t){var n=t;this.injectBinder.bind(t).to(t),this.injectBinder.bind(r.Pool).to(r.Pool).toName(r.CommandConst.COMMAND_POOL);var e=this.injectBinder.getInstance(r.Pool,r.CommandConst.COMMAND_POOL);return this.injectBinder.unbind(r.Pool,r.CommandConst.COMMAND_POOL),e.bind(n),e},t.prototype.getRawBinding=function(){return new r.CommandBinding(this.resolver.bind(this))},t.prototype.bind=function(t){return i.prototype.bind.call(this,t)},t.prototype.invokeCommand=function(t,n,e,o){var i=this.createCommand(t,e);return i.sequenceId=o,this.trackCommand(i,n),this.executeCommand(i,e),i},t.prototype.createCommand=function(t,n){var e=this.getCommand(t);if(null!=e)return e.data=n,e;var o="A Command ";throw null!=n&&(o+="tied to data "+n.toString()),o+=" could not be instantiated.\nThis might be caused by a null pointer during instantiation or failing to override Execute (generally you shouldn't have constructor code in Commands).",new Error(o)},t.prototype.getCommand=function(t){if(this.usePooling&&this.pools.has(t)){var n=this.pools.get(t);return(e=n.getInstance())?e.isClean&&(this.injectBinder.getInjector().inject(e,!1),e.deploy()):(e=this.injectBinder.getInstance(t,null),n.add(e)),e}this.injectBinder.bind(r.NCommand).to(t);var e=this.injectBinder.getInstance(r.NCommand,null);return this.injectBinder.unbind(r.NCommand,null),e},t.prototype.trackCommand=function(t,n){n.isSequence?this.activeSequences.set(t,n):this.activeCommands.add(t)},t.prototype.executeCommand=function(t,n){null!=t&&t.execute.apply(t,n)},t.prototype.onDispose=function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];var o=this.getBinding(t,null);if(null!=o)if(o.isSequence)this.next(o,n,0);else for(var i=o.value.length+1,r=0;r<i;r++)this.next(o,n,r)},t.prototype.next=function(t,n,e){var o=t.value;if(0===o.length&&(o=[]).push(t.value),e<o.length){var i=o[e],r=this.invokeCommand(i,t,n,e);this.releaseCommand(r)}else this.disposeOfSequencedData(n),t.isOnce&&this.unbind(t,null)},t.prototype.disposeOfSequencedData=function(t){},t.prototype.releaseCommand=function(t){if(!t.isRetain){var n=t.constructor;if(this.usePooling&&this.pools.has(n)&&this.pools.get(n).returnInstance(t),this.activeCommands.has(t))this.activeCommands.delete(t);else if(this.activeSequences.has(t)){var e=this.activeSequences.get(t),o=t.data;this.activeSequences.delete(t),this.next(e,o,t.sequenceId+1)}}},__decorate([r.inject(r.NInjectBinder)],t.prototype,"injectBinder",void 0),t}(r.Binder),n=function(o){function t(){var t=null!==o&&o.apply(this,arguments)||this;return t.usePooling=!0,t}return __extends(t,o),t.prototype.resolveBinding=function(t,n){(o.prototype.resolveBinding.call(this,t,n),this._bindings.has(n))&&n.addListener(this.onDispose.bind(this))},t.prototype.bind=function(t){var n=this.injectBinder.getBinding(t,null),e=null;return r.Binding.isConstructor(t)&&(null==n&&(n=this.injectBinder.bind(t)).toSingleton(),e=this.injectBinder.getInstance(t,null)),e?o.prototype.bind.call(this,e):o.prototype.bind.call(this,t)},t.prototype.getBinding=function(t,n){var e;return e=r.Binding.isConstructor(t)?this.injectBinder.getInstance(t,n):t,o.prototype.getBinding.call(this,e,n)},t.prototype.invokeCommand=function(t,n,e,o){n.key;var i=this.createCommandForSignal(t,e);return i.sequenceId=o,this.trackCommand(i,n),this.executeCommand(i,e),i},t.prototype.createCommandForSignal=function(t,n){if(null!=n)new Set;var e=this.getCommand(t);return e.data=n,e},t}(r.CommandBinder=t);r.SignalCommandBinder=n}(ioc||(ioc={}));var ioc;__decorate=this&&this.__decorate||function(t,n,e,o){var i,r=arguments.length,s=r<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,n,e,o);else for(var c=t.length-1;0<=c;c--)(i=t[c])&&(s=(r<3?i(s):3<r?i(n,e,s):i(n,e))||s);return 3<r&&s&&Object.defineProperty(n,e,s),s};!function(n){var t=function(){function t(){}return Object.defineProperty(t.prototype,"constructorName",{get:function(){return"ICommand"},enumerable:!0,configurable:!0}),t}();n.NCommand=t;var e=function(){function t(){this._clean=!1,this._retain=!1}return t.prototype.deploy=function(){this._clean=!1},t.prototype.clean=function(){this._clean=!0},Object.defineProperty(t.prototype,"isClean",{get:function(){return this._clean},enumerable:!0,configurable:!0}),t.prototype.retain=function(){this._retain=!0},t.prototype.release=function(){this._retain=!1},Object.defineProperty(t.prototype,"isRetain",{get:function(){return this._retain},enumerable:!0,configurable:!0}),t.prototype.restore=function(){this.injectBinder.getInjector().uninject(this),this.clean()},t.prototype.execute=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n]},__decorate([n.inject(n.NInjectBinder)],t.prototype,"injectBinder",void 0),__decorate([n.inject(n.NCommandBinder)],t.prototype,"commandBinder",void 0),t}();n.Command=e}(ioc||(ioc={})),function(t){var n=function(){function t(){}return Object.defineProperty(t.prototype,"constructorName",{get:function(){return"IContext"},enumerable:!0,configurable:!0}),t}();t.NContext=n;var e=function(){function n(t){null==n.firstContext||null==n.firstContext.getRoot()?(n.firstContext=this).crossContextBinder=this.injectBinder:n.firstContext.addCrossContext(this),this.setRoot(t),this.addCore(),this.start()}return Object.defineProperty(n.prototype,"injectBinder",{get:function(){return this._injectBinder||(this._injectBinder=new t.InjectBinder),this._injectBinder},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"crossContextBinder",{get:function(){return this._crossContextBinder},set:function(t){this._crossContextBinder=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"commandBinder",{get:function(){return this._commandBinder},enumerable:!0,configurable:!0}),n.prototype.getRoot=function(){return this.root},n.prototype.addCrossContext=function(t){return t.crossContextBinder=this.injectBinder,this},n.prototype.removeCrossContext=function(t){},n.prototype.setRoot=function(t){return this.root=t,this},n.prototype.restart=function(){return this.addCore(),this.start(),this},n.prototype.start=function(){return this.instantiateCore(),this.mapBindings(),this.postBindings(),this.launch(),this},n.prototype.launch=function(){},n.prototype.instantiateCore=function(){this._commandBinder=this.injectBinder.getInstance(t.NCommandBinder,null)},n.prototype.mapBindings=function(){},n.prototype.postBindings=function(){},n.prototype.addCore=function(){this.injectBinder.bind(t.NInjectBinder).toValue(this.injectBinder),this.injectBinder.bind(t.NCommandBinder).to(t.SignalCommandBinder).toSingleton(),this.injectBinder.bind(t.CommonEnum.Context).toValue(this),this.injectBinder.bind(t.CommonEnum.Root).toValue(this.root)},n}();t.Context=e}(ioc||(ioc={})),function(t){var n=function(){function t(){}return Object.defineProperty(t.prototype,"constructorName",{get:function(){return"IRoot"},enumerable:!0,configurable:!0}),t}();t.NRoot=n}(ioc||(ioc={})),function(t){var n=function(){function t(){}return Object.defineProperty(t.prototype,"list",{get:function(){return this._list},set:function(t){this._list=t},enumerable:!0,configurable:!0}),t}();t.DecoratorClass=n}(ioc||(ioc={})),function(t){var n=function(){function t(){}return Object.defineProperty(t.prototype,"constructorName",{get:function(){return"ISignal"},enumerable:!0,configurable:!0}),t}();t.NSignal=n;var e=function(){function t(){this._listener=[],this._onceListener=[]}return t.prototype.dispatch=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var e=this;e._listener&&0!=e._listener.length&&this._listener.forEach(function(t){t.apply(void 0,[e].concat(n))}),e._onceListener&&0!=e._onceListener.length&&this._listener.forEach(function(t){t.apply(void 0,[e].concat(n))}),this._onceListener.length=0},t.prototype.addListener=function(t){this._listener=this.addUnique(this._listener,t)},t.prototype.addOnceListener=function(t){this._onceListener=this.addUnique(this._onceListener,t)},t.prototype.removeAllListeners=function(){this._listener.length=0,this._onceListener.length=0},t.prototype.addUnique=function(t,n){if(t){for(var e=!1,o=0;o<t.length;o++)if(t[o]===n){e=!0;break}e||t.push(n)}return t},t.prototype.getTypes=function(){return[]},t}();t.Signal=e}(ioc||(ioc={})),function(e){var t=function(){function t(){}return Object.defineProperty(t.prototype,"constructorName",{get:function(){return"ISignalManager"},enumerable:!0,configurable:!0}),t}();e.NSignalManager=t;var n=function(){function t(){this._signal_dic=new Map,this.info="this is a signal manager"}return t.prototype.get=function(t){if(this._signal_dic.has(t))return this._signal_dic.get(t);var n=new e.Signal;return"string"==typeof t&&(n.name=t),this._signal_dic.set(t,n),n},t.prototype.delete=function(t){if(this._signal_dic.has(t))return this._signal_dic.delete(t)},t}();e.SignalManager=n}(ioc||(ioc={}));